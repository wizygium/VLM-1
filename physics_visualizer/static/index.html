<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handball Physics Visualizer</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="app-container">
        <!-- Top Bar: Header & Selector -->
        <header class="top-bar">
            <div class="logo">
                <h1>ü§æ VLM-1 Visualizer</h1>
            </div>
            <div class="selector-group">
                <select id="analysis-select">
                    <option value="">Loading analyses...</option>
                </select>
                <div id="analysis-info" class="analysis-info hidden">
                    <span id="info-frames">0f</span> ‚Ä¢ <span id="info-duration">0s</span>
                    <!-- Hidden elements preserved for JS compatibility if needed -->
                    <span id="info-players" style="display:none"></span>
                </div>
            </div>
        </header>

        <!-- Main Stage: Video & Court -->
        <main class="main-stage">
            <!-- Left: Video Panel -->
            <div class="panel video-panel">
                <div class="video-container">
                    <video id="video-player" playsinline></video>
                    <div id="video-loading" class="loading-overlay hidden">
                        <div class="spinner"></div>
                    </div>
                    <div id="video-error" class="error-overlay hidden">
                        <p>‚ö†Ô∏è Video Error</p>
                    </div>
                </div>
            </div>

            <!-- Right: Court Panel -->
            <div class="panel court-panel">
                <div class="court-container">
                    <canvas id="court-canvas"></canvas>
                </div>
                <div id="zone-legend" class="zone-legend-overlay hidden">
                    <!-- Dynamic content -->
                </div>
            </div>

            <!-- Side: Events / Info (Collapsible) -->
            <div class="panel info-panel">
                <div class="info-tabs">
                    <button class="tab-btn active" data-tab="events">Timeline</button>
                </div>
                <div id="timeline-filters" class="timeline-filters hidden">
                    <button class="filter-btn active" data-filter="all">All</button>
                    <button class="filter-btn" data-filter="changes">Changes</button>
                    <button class="filter-btn" data-filter="events">Events</button>
                </div>
                <!-- Events List -->
                <div id="events-list" class="scrollable-list">
                    <div class="placeholder">Waiting for analysis...</div>
                </div>

                <!-- Hidden Tracked Players for JS compatibility -->
                <div id="players-list" class="players-list hidden" style="display:none">
                    <ul id="attackers-list"></ul>
                    <ul id="defenders-list"></ul>
                </div>
            </div>
        </main>

        <!-- Bottom Bar: Controls -->
        <footer class="controls-bar">
            <div class="playback-controls">
                <button id="prev-frame-btn" class="icon-btn" title="Previous Frame">‚èÆ</button>
                <button id="play-pause-btn" class="icon-btn primary" title="Play/Pause">‚ñ∂Ô∏è</button>
                <button id="next-frame-btn" class="icon-btn" title="Next Frame">‚è≠</button>
            </div>

            <div class="timeline-group">
                <span id="current-time">0.00s</span>
                <input type="range" id="timeline-scrubber" min="0" max="100" value="0" step="0.1">
                <span id="info-duration-display">0.00s</span>
            </div>

            <div class="settings-group">
                <select id="playback-speed" class="speed-select">
                    <option value="0.25">0.25x</option>
                    <option value="0.5">0.5x</option>
                    <option value="1" selected>1.0x</option>
                    <option value="2">2.0x</option>
                </select>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="/static/court-renderer.js"></script>
    <script src="/static/app.js"></script>
    <script>
        // Polyfill for info-duration duplication if app.js targets it by ID
        // app.js likely uses `getElementById('info-duration')`. 
        // We have `info-duration` in the top bar. `info-duration-display` is in the bottom bar.
        // We can sync them if needed, but app.js only writes to one. 
        // Let's ensure the JS writes to the top one and we mirror it or CSS handles it.
        const originalDuration = document.getElementById('info-duration');
        const displayDuration = document.getElementById('info-duration-display');

        // Simple observer to copy text content if needed
        if (originalDuration && displayDuration) {
            const observer = new MutationObserver(() => {
                displayDuration.textContent = originalDuration.textContent;
            });
            observer.observe(originalDuration, { childList: true, characterData: true, subtree: true });
        }
    </script>
</body>

</html>